import re

import pycountry
dialling_codes = [['+1204', 'CA'],
 ['+1226', 'CA'],
 ['+1236', 'CA'],
 ['+1249', 'CA'],
 ['+1250', 'CA'],
 ['+1289', 'CA'],
 ['+1306', 'CA'],
 ['+1343', 'CA'],
 ['+1365', 'CA'],
 ['+1403', 'CA'],
 ['+1416', 'CA'],
 ['+1418', 'CA'],
 ['+1431', 'CA'],
 ['+1437', 'CA'],
 ['+1438', 'CA'],
 ['+1450', 'CA'],
 ['+1506', 'CA'],
 ['+1514', 'CA'],
 ['+1519', 'CA'],
 ['+1579', 'CA'],
 ['+1581', 'CA'],
 ['+1587', 'CA'],
 ['+1604', 'CA'],
 ['+1613', 'CA'],
 ['+1639', 'CA'],
 ['+1647', 'CA'],
 ['+1705', 'CA'],
 ['+1709', 'CA'],
 ['+1778', 'CA'],
 ['+1780', 'CA'],
 ['+1807', 'CA'],
 ['+1819', 'CA'],
 ['+1867', 'CA'],
 ['+1873', 'CA'],
 ['+1902', 'CA'],
 ['+1905', 'CA'],
 ['+1268', 'AG'],
 ['+1242', 'BS'],
 ['+1246', 'BB'],
 ['+1767', 'DM'],
 ['+1809', 'DO'],
 ['+1473', 'GD'],
 ['+3906', 'VA'],
 ['+1876', 'JM'],
 ['+1869', 'KN'],
 ['+1758', 'LC'],
 ['+1784', 'VC'],
 ['+1868', 'TT'],
 ['1829', 'DO'],
 ['1849', 'DO'],
 ['+355', 'AL'],
 ['+213', 'DZ'],
 ['+376', 'AD'],
 ['+244', 'AO'],
 ['+374', 'AM'],
 ['+994', 'AZ'],
 ['+973', 'BH'],
 ['+880', 'BD'],
 ['+375', 'BY'],
 ['+501', 'BZ'],
 ['+229', 'BJ'],
 ['+975', 'BT'],
 ['+591', 'BO'],
 ['+387', 'BA'],
 ['+267', 'BW'],
 ['+673', 'BN'],
 ['+359', 'BG'],
 ['+226', 'BF'],
 ['+257', 'BI'],
 ['+238', 'CV'],
 ['+855', 'KH'],
 ['+237', 'CM'],
 ['+236', 'CF'],
 ['+235', 'TD'],
 ['+269', 'KM'],
 ['+242', 'CG'],
 ['+682', 'CK'],
 ['+506', 'CR'],
 ['+385', 'HR'],
 ['+357', 'CY'],
 ['+420', 'CZ'],
 ['+225', 'CI'],
 ['+850', 'KP'],
 ['+243', 'CD'],
 ['+253', 'DJ'],
 ['+593', 'EC'],
 ['+503', 'SV'],
 ['+240', 'GQ'],
 ['+291', 'ER'],
 ['+372', 'EE'],
 ['+251', 'ET'],
 ['+679', 'FJ'],
 ['+358', 'FI'],
 ['+241', 'GA'],
 ['+220', 'GM'],
 ['+995', 'GE'],
 ['+233', 'GH'],
 ['+502', 'GT'],
 ['+224', 'GN'],
 ['+245', 'GW'],
 ['+592', 'GY'],
 ['+509', 'HT'],
 ['+504', 'HN'],
 ['+354', 'IS'],
 ['+964', 'IQ'],
 ['+353', 'IE'],
 ['+972', 'IL'],
 ['+962', 'JO'],
 ['+254', 'KE'],
 ['+686', 'KI'],
 ['+965', 'KW'],
 ['+996', 'KG'],
 ['+856', 'LA'],
 ['+371', 'LV'],
 ['+961', 'LB'],
 ['+266', 'LS'],
 ['+231', 'LR'],
 ['+218', 'LY'],
 ['+423', 'LI'],
 ['+370', 'LT'],
 ['+352', 'LU'],
 ['+261', 'MG'],
 ['+265', 'MW'],
 ['+960', 'MV'],
 ['+223', 'ML'],
 ['+356', 'MT'],
 ['+692', 'MH'],
 ['+222', 'MR'],
 ['+230', 'MU'],
 ['+691', 'FM'],
 ['+377', 'MC'],
 ['+976', 'MN'],
 ['+382', 'ME'],
 ['+212', 'MA'],
 ['+258', 'MZ'],
 ['+264', 'NA'],
 ['+674', 'NR'],
 ['+977', 'NP'],
 ['+505', 'NI'],
 ['+227', 'NE'],
 ['+234', 'NG'],
 ['+683', 'NU'],
 ['+968', 'OM'],
 ['+680', 'PW'],
 ['+507', 'PA'],
 ['+675', 'PG'],
 ['+595', 'PY'],
 ['+351', 'PT'],
 ['+974', 'QA'],
 ['+373', 'MD'],
 ['+250', 'RW'],
 ['+685', 'WS'],
 ['+378', 'SM'],
 ['+239', 'ST'],
 ['+966', 'SA'],
 ['+221', 'SN'],
 ['+381', 'RS'],
 ['+248', 'SC'],
 ['+232', 'SL'],
 ['+421', 'SK'],
 ['+386', 'SI'],
 ['+677', 'SB'],
 ['+252', 'SO'],
 ['+211', 'SS'],
 ['+970', 'PS'],
 ['+249', 'SD'],
 ['+597', 'SR'],
 ['+963', 'SY'],
 ['+992', 'TJ'],
 ['+389', 'MK'],
 ['+670', 'TL'],
 ['+228', 'TG'],
 ['+676', 'TO'],
 ['+216', 'TN'],
 ['+993', 'TM'],
 ['+688', 'TV'],
 ['+256', 'UG'],
 ['+380', 'UA'],
 ['+971', 'AE'],
 ['+255', 'TZ'],
 ['+598', 'UY'],
 ['+998', 'UZ'],
 ['+678', 'VU'],
 ['+967', 'YE'],
 ['+260', 'ZM'],
 ['+263', 'ZW'],
 ['+93', 'AF'],
 ['+54', 'AR'],
 ['+61', 'AU'],
 ['+43', 'AT'],
 ['+32', 'BE'],
 ['+55', 'BR'],
 ['+56', 'CL'],
 ['+86', 'CN'],
 ['+57', 'CO'],
 ['+53', 'CU'],
 ['+45', 'DK'],
 ['+20', 'EG'],
 ['+33', 'FR'],
 ['+49', 'DE'],
 ['+30', 'GR'],
 ['+36', 'HU'],
 ['+91', 'IN'],
 ['+62', 'ID'],
 ['+98', 'IR'],
 ['+39', 'IT'],
 ['+81', 'JP'],
 ['+60', 'MY'],
 ['+52', 'MX'],
 ['+95', 'MM'],
 ['+31', 'NL'],
 ['+64', 'NZ'],
 ['+47', 'NO'],
 ['+92', 'PK'],
 ['+51', 'PE'],
 ['+63', 'PH'],
 ['+48', 'PL'],
 ['+82', 'KR'],
 ['+40', 'RO'],
 ['+65', 'SG'],
 ['+27', 'ZA'],
 ['+34', 'ES'],
 ['+94', 'LK'],
 ['+46', 'SE'],
 ['+41', 'CH'],
 ['+66', 'TH'],
 ['+90', 'TR'],
 ['+44', 'GB'],
 ['+58', 'VE'],
 ['+84', 'VN'],
 ['+77', 'KZ'],
 ['+7', 'RU'],
 ['+1', 'US']]

codes_and_countries = [
    [code, pycountry.countries.lookup(alpha_2)]
    for code, alpha_2 in dialling_codes
]

phone_regex =re.compile(r'(?i)(?:tel|call|phone|telephone|fax|efax|facsimile|office hours|out of hours|helpline|mobile|switchboard)(?: (?:direct|number|call|no))?(?:\W+\w+)?\W+\+\d{1,3}[ -]?\d+[- ]?\d*[- ]?\d*\b')

def find_phone_numbers(text: str) -> list:
    """
    Find the countries mentioned in the text by phone number international dialling codes.
    :param text: the text of the protocol page
    :return: nationalities found as a list of tuples (PyCountry object and Match object).
    """
    country_matches = []

    matches = phone_regex.finditer(text)
    for match in matches:
        match_string = match.group()
        m = re.sub(r'[^\+\d]', '', match_string)
        for d, c in codes_and_countries:
            if d in m:
                country_matches.append((c, match))

    return country_matches
